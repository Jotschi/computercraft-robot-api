os.loadAPI("disk/apis/cClient")

mon = peripheral.wrap("left")
function clear()
  for i=1,200 do
    paintutils.drawLine(i,1,i,200, colors.black)
  end 
end

clear()

function getHeight()
  local statusData = cClient.sendRequestFor({cmd="status"})
  if (statusData) then
     return  statusData["height"];
  end

  return false
end

--  print("height:" .. statusData["height"])
-- 181
--print("break-enabled:" .. tostring(statusData["break-enabled"]))
--print("gps-docked" .. tostring(statusData["gpsdocked"]))

function drawRow(row, len) 
   paintutils.drawLine(row,1,row,len,colors.green)
end

function drawStats(x)
  local row = 2
  local maxLen = 40
  
  while x > 40 do
    row = row + 1
    x = x - 40
    drawRow(row,x)
  end
  drawRow(row,x)
  os.sleep(1)
end

while true do
   local height = getHeight()

   if (height) then
     clear()
     paintutils.drawLine(1,15, 8,15, colors.brown)
     mon.setCursorPos(1,1)
     mon.clearLine()
     mon.write(height)
     drawStats(height)
   else
    os.sleep(1)   
   end
end
